angular.module("agent",["cfp.loadingBar","ui-notification"]).config(["NotificationProvider",function(e){e.setOptions({delay:5e3,startTop:10,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"right",positionY:"bottom"})}]).controller("MainController",["$scope","$http","$timeout","cfpLoadingBar","Notification","$q",function(e,n,i,o,t,r){function s(){window.SerproSignerClient.setUriServer("wss","127.0.0.1",65156,"/signer"),window.SerproSignerClient.setDebug(!0)}function l(){window.SerproSignerClient.connect(c,c,u)}function a(){s(),window.SerproSignerClient.verifyIsInstalledAndRunning().success(function(n){i(function(){e.desktopInstalledRunning=!0},100),clearInterval(g),l()}).error(function(n){console.log("verifyDesktopClientInstallation ERRO"),i(function(){e.desktopInstalledRunning=!1},100),clearInterval(g),g=setTimeout(a,f)})}function c(n){1===n?(console.log("Connected on Server"),i(function(){e.serverIsOn=!0},100),clearInterval(d)):(console.log("Warn user to download/execute Agent-Desktop AND try again in "+f+"ms"),i(function(){e.serverIsOn=!1},100),clearInterval(d),d=setTimeout(a,f))}function u(n){i(function(){void 0!==n.error&&(null!==n.error&&"null"!==n.error?t.error({message:n.error}):t.error({message:"Unknown error"})),e.stopRequest()},100)}e.desktopInstalledRunning=!1,e.desktopEnabled=!1,e.serverIsOn=!1;var d,g,f=3e3;e.$watch("[desktopInstalledRunning,desktopEnabled]",function(){e.serverIsOn=e.desktopInstalledRunning&&e.desktopEnabled}),a(),e.startRequest=function(){o.start()},e.stopRequest=function(){o.complete()},e.signFileWithDefaults=function(){e.startRequest(),window.SerproSignerClient.signerFileUsingDefaults().success(function(n){i(function(){n.actionCanceled?(console.log("Action Canceled"),t.error({message:"Action Canceled by User"})):(console.log(n),e.fileName=n.original,e.signedFileName=n.signed),e.stopRequest()},100)}).error(function(n){i(function(){console.log(n),t.error({message:n.error}),e.stopRequest()},100)})},e.validate=function(){window.SerproSignerClient.validateFile().success(function(n){console.log(n),i(function(){e.validation=n},100)}).error(function(n){console.log(n),i(function(){e.validation=n},100)})},e.isIE=is.ie(),e.isEdge=is.edge(),e.isChrome=is.chrome(),e.isFirefox=is.firefox(),e.isOpera=is.opera(),e.isSafari=is.safari(),e.isWindows=is.windows(),e.isMac=is.mac(),e.isLinux=is.linux(),e.isDesktop=is.desktop(),e.isMbile=is.mobile(),e.isBlackberry=is.blackberry()}]);