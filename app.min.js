angular.module("agent",["cfp.loadingBar","ui-notification"]).config(["NotificationProvider",function(n){n.setOptions({delay:5e3,startTop:10,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"right",positionY:"bottom"})}]).controller("MainController",["$scope","$http","$timeout","cfpLoadingBar","Notification","$q",function(n,e,o,t,i,r){function s(){window.SerproSignerClient.setUriServer("wss://localhost:65156/signer"),window.SerproSignerClient.setDebug(!1)}function l(){window.SerproSignerClient.connect(a,a,u)}function c(){s(),window.SerproSignerClient.verifyIsInstalledAndRunning().success(function(e){o(function(){n.desktopInstalled=!0,n.desktopRunning=!0},100),clearInterval(g),l()}).error(function(e){console.log("verifyDesktopClientInstallation ERRO"),o(function(){n.desktopInstalled=!1,n.desktopRunning=!1},100),clearInterval(g),g=setTimeout(c,f)})}function a(e){1===e?(console.log("Connected on Server"),o(function(){n.serverIsOn=!0},100),clearInterval(d)):(console.log("Warn user to download/execute Agent-Desktop AND try again in "+f+"ms"),o(function(){n.serverIsOn=!1},100),clearInterval(d),d=setTimeout(c,f))}function u(e){o(function(){void 0!==e.error&&(null!==e.error&&"null"!==e.error?i.error({message:e.error}):i.error({message:"Unknown error"})),n.stopRequest()},100)}n.desktopInstalled=!1,n.desktopRunning=!1,n.desktopEnabled=!1,n.serverIsOn=!1;var d,g,f=2e3;n.$watch("[desktopInstalled,desktopRunning,desktopEnabled]",function(){n.serverIsOn=n.desktopInstalled&&n.desktopRunning&&n.desktopEnabled}),c(),n.startRequest=function(){t.start()},n.stopRequest=function(){t.complete()},n.signFileWithDefaults=function(){n.startRequest(),window.SerproSignerClient.signerFileUsingDefaults().success(function(e){o(function(){e.actionCanceled?(console.log("Action Canceled"),i.error({message:"Action Canceled by User"})):(console.log(e),n.fileName=e.original,n.signedFileName=e.signed),n.stopRequest()},100)}).error(function(e){o(function(){console.log(e),i.error({message:e.error}),n.stopRequest()},100)})},n.validate=function(){window.SerproSignerClient.validateFile().success(function(e){console.log(e),o(function(){n.validation=e},100)}).error(function(e){console.log(e),o(function(){n.validation=e},100)})}}]);