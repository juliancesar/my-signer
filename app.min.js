angular.module("agent",["cfp.loadingBar","ui-notification"]).config(["NotificationProvider",function(e){e.setOptions({delay:5e3,startTop:10,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"right",positionY:"bottom"})}]).controller("MainController",["$scope","$http","$timeout","cfpLoadingBar","Notification","$q",function(e,n,o,t,r,i){function s(){window.SerproSignerClient.setUriServer("wss://localhost:65156/signer"),window.SerproSignerClient.setDebug(!1)}function l(){window.SerproSignerClient.connect(u,u,d)}function a(){return console.log("navigator.userAgent: "+navigator.userAgent),!0}function c(){e.supportedBrowser=a(),e.supportedBrowser?(s(),window.SerproSignerClient.verifyIsInstalledAndRunning().success(function(n){o(function(){e.desktopInstalled=!0,e.desktopRunning=!0},100),clearInterval(p),l()}).error(function(n){console.log("verifyDesktopClientInstallation ERRO"),o(function(){e.desktopInstalled=!1,e.desktopRunning=!1},100),clearInterval(p),p=setTimeout(c,f)})):r.error({message:"Current Borwser is Not Supported by Serpro Signer."})}function u(n){1===n?(console.log("Connected on Server"),o(function(){e.serverIsOn=!0},100),clearInterval(g)):(console.log("Warn user to download/execute Agent-Desktop AND try again in "+f+"ms"),o(function(){e.serverIsOn=!1},100),clearInterval(g),g=setTimeout(c,f))}function d(n){o(function(){void 0!==n.error&&(null!==n.error&&"null"!==n.error?r.error({message:n.error}):r.error({message:"Unknown error"})),e.stopRequest()},100)}e.desktopInstalled=!1,e.desktopRunning=!1,e.desktopEnabled=!1,e.supportedBrowser=!1,e.serverIsOn=!1;var g,p,f=2e3;e.$watch("[desktopInstalled,desktopRunning,desktopEnabled, supportedBrowser]",function(){e.serverIsOn=e.desktopInstalled&&e.desktopRunning&&e.desktopEnabled}),c(),e.startRequest=function(){t.start()},e.stopRequest=function(){t.complete()},e.signFileWithDefaults=function(){e.startRequest(),window.SerproSignerClient.signerFileUsingDefaults().success(function(n){o(function(){n.actionCanceled?(console.log("Action Canceled"),r.error({message:"Action Canceled by User"})):(console.log(n),e.fileName=n.original,e.signedFileName=n.signed),e.stopRequest()},100)}).error(function(n){o(function(){console.log(n),r.error({message:n.error}),e.stopRequest()},100)})},e.validate=function(){window.SerproSignerClient.validateFile().success(function(n){console.log(n),o(function(){e.validation=n},100)}).error(function(n){console.log(n),o(function(){e.validation=n},100)})}}]);